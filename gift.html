<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Diwali Collage</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, #2E1A47, #7B3F00, #F9A826);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
  color: #FFF5E1;
}

h2 {
  font-size: 2rem;
  margin-bottom: 20px;
  text-shadow: 0 0 15px #FFD700;
}

#frame-container {
  position: relative;
  width: 400px;
  height: 400px;
  background: #fff8e1;
  border-radius: 20px;
  overflow: hidden;
  margin-bottom: 20px;
  box-shadow: 0 0 20px rgba(255,215,0,0.5);
  border: 5px dashed gold;
}

.frame {
  position: absolute;
  background: #fff8e1;
  border: 2px solid gold;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  font-size: 18px;
}

.frame img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  transform-origin: center center; /* important for zoom */
}

.circle-frame {
  border-radius: 50%;
}

.frame-decoration {
  position: absolute;
  font-size: 18px;
}

#emoji-picker {
  margin-top: 10px;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  max-width: 90%;
}

.emoji-option {
  font-size: 30px;
  margin: 5px;
  cursor: pointer;
}

.emoji {
  position: absolute;
  font-size: 40px;
  cursor: grab;
  z-index: 10;
}

button#downloadBtn {
  margin-top: 15px;
  padding: 0.8rem 2rem;
  font-size: 1.2rem;
  border: none;
  border-radius: 50px;
  background: linear-gradient(90deg, #FF8C00, #FFD700);
  color: #1E0F00;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 0 15px #FFD700;
  transition: 0.3s ease;
}

button#downloadBtn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 25px #FFD700, 0 0 40px #FF8C00;
}
</style>
</head>
<body>

<h2>🎉 Create Your Diwali Collage 🎉</h2>

<div id="frame-container"></div>
<div id="photo-inputs"></div>
<div id="emoji-picker"></div>

<script>
// Emojis
const allEmojis = ["😀","😃","😄","😁","😆","😅","😂","🤣","😊","😇","🙂","🙃","😉","😌","😍","🥰","😘","😗","😙","😚","😋","😛","😝","😜","🤪","🤨","🧐","🤓","😎","🥳","😏","😒","😞","😔","😟","😕","🙁","☹️","😣","😖","😫","😩","🥺","😢","😭","😤","😠","😡","🤬","🤯","😳","🥵","🥶","😱","😨","😰","😥","😓","🤗","🤔","🤭","🤫","🤥","😶","😐","😑","😬","🙄","😯","😦","😧","😮","😲","🥱","😴","🤤","😪","😵","🤐","🥴","🤢","🤮","🤧","😷","🤒","🤕","🤑","🤠","😈","👿","👹","👺","💀","☠️","👻","👽","👾","🤖","💩","🧠","🫀","🫁","🦴","🦷","👁️","👀","👅","👄","🫦","👶","🧒","👦","👧","🧑","👱‍♀️","👱‍♂️","👨","👩","🧔","👵","👴","👲","👳‍♀️","👳‍♂️","🧕","👮‍♀️","👮‍♂️","👷‍♀️","👷‍♂️","💂‍♀️","💂‍♂️","🕵️‍♀️","🕵️‍♂️","👩‍⚕️","👨‍⚕️","👩‍🎓","👨‍🎓","👩‍🏫","👨‍🏫","👩‍⚖️","👨‍⚖️","👩‍🌾","👨‍🌾","👩‍🍳","👨‍🍳","👩‍🎤","👨‍🎤","👩‍🏭","👨‍🏭","👩‍💻","👨‍💻","👩‍💼","👨‍💼","👩‍🔧","👨‍🔧","👩‍🔬","👨‍🔬","👩‍🎨","👨‍🎨","👩‍🚒","👨‍🚒","🧑‍🚀","🧑‍✈️","💃","🕺","🕴️","👯‍♀️","👯‍♂️","🧖‍♀️","🧖‍♂️","🧘‍♀️","🧘‍♂️","🛀","🛌","👪","👨‍👩‍👧","👨‍👩‍👧‍👦","🦄","🐶","🐱","🐭","🐹","🐰","🦊","🐻","🐼","🐨","🐯","🦁","🐮","🐷","🐽","🐸","🐵","🐒","🦍","🦧","🐔","🐧","🐦","🐤","🐣","🐥","🦆","🦅","🦉","🦇","🐺","🐗","🐴","🦄","🐝","🪱","🦋","🐌","🐞","🐜","🍏","🍎","🍐","🍊","🍋","🍌","🍉","🍇","🍓","🫐","🍈","🍒","🍑","🥭","🍍","🥥","🥝","🍅","🍆","🥑","🍄","🥦","🥬","🥒","🌶️","🫑","🌽","🥕","🫒","🧄","🧅","🥔","🍠","🥐","🥯","🍞","🥖","🥨","🧀","🥚","🪔","🎆","🎇","🎉","🎊","✨","⭐","💫","🌟","🔥","💥","☀️","🌤️","⛅","🌥️","☁️","🌦️","🌈","🌧️","⛈️","🌩️","🌨️","❄️","☃️","⛄","💨","💧","🌊","🎏","🎐","🎑","🧧","🎀","🎁","🎗️","🎞️","🎟️","🎠","🛝","🎨","🖼️","🎢","🎡","🧵","🧶","🪢","🛒","👓","🕶️","🥽","🧥","👔","👕","👖","🩳","🧤","🧦","👗","🥻","👘","👚","💍","💋","💄","⚽","⚾","🏈","🎂","🍰","🍨","🍫","🍭","☕","🩷","💛","💙","💜","🤍","🩶","💔","❤️‍🔥","❤️‍🩹","❣️","💞","💓","💗","💘","💝","💟","💌","♾️","💮","➿","1️⃣","2️⃣","3️⃣","4️⃣","5️⃣","6️⃣","7️⃣","8️⃣","9️⃣","🔟","▫️","▪️"];

const emojiPicker = document.getElementById("emoji-picker");
allEmojis.forEach(e=>{
  const span = document.createElement("span");
  span.textContent = e;
  span.classList.add("emoji-option");
  emojiPicker.appendChild(span);
});

const name = localStorage.getItem("diwaliUserName") || "Friend";
const frameContainer = document.getElementById("frame-container");
const photoInputsDiv = document.getElementById("photo-inputs");
let frames = [];

const templates = [
  [{ top:20, left:20, width:160, height:160, circle:false, deco:["🍬","⭐"] },
   { top:220, left:220, width:160, height:160, circle:false, deco:["🪔","🎆"] }],
  [{ top:20, left:20, width:120, height:120, circle:false, deco:["✨","🍬"] },
   { top:20, left:260, width:120, height:120, circle:false, deco:["🎉","⭐"] },
   { top:220, left:140, width:120, height:120, circle:false, deco:["🎆","💫"] }],
  [{ top:20, left:20, width:120, height:120, circle:false, deco:["🍬","🎇"] },
   { top:20, left:260, width:120, height:120, circle:false, deco:["✨","🎆"] },
   { top:220, left:20, width:120, height:120, circle:false, deco:["🪔","⭐"] },
   { top:150, left:150, width:100, height:100, circle:true, deco:["💫","🎉"] }],
  [{ top:50, left:50, width:300, height:150, circle:false, deco:["🍭","🎆"] },
   { top:200, left:50, width:300, height:150, circle:false, deco:["✨","🎉"] }],
  [{ top:20, left:20, width:120, height:120, circle:false, deco:["⭐","🎆"] },
   { top:140, left:140, width:120, height:120, circle:false, deco:["💫","🪔"] },
   { top:260, left:260, width:120, height:120, circle:false, deco:["🍬","🎇"] }]
];

const userTemplate = templates[Math.floor(Math.random() * templates.length)];

userTemplate.forEach((f,i)=>{
  const frame = document.createElement("div");
  frame.classList.add("frame");
  if(f.circle) frame.classList.add("circle-frame");
  frame.style.top = f.top + "px";
  frame.style.left = f.left + "px";
  frame.style.width = f.width + "px";
  frame.style.height = f.height + "px";

  const img = document.createElement("img");
  img.alt = "Photo";
  frame.appendChild(img);
  frameContainer.appendChild(frame);
  frames.push(img);

  // Decorations
  f.deco.forEach((e,index)=>{
    const deco = document.createElement("span");
    deco.textContent = e;
    deco.classList.add("frame-decoration");
    if(index===0) { deco.style.top="5px"; deco.style.left="5px"; }
    if(index===1) { deco.style.bottom="5px"; deco.style.right="5px"; }
    frame.appendChild(deco);
  });

  // File input
  const input = document.createElement("input");
  input.type="file";
  input.accept="image/*";
  input.dataset.index = i;
  input.addEventListener("change",(ev)=>{
    const file = ev.target.files[0];
    if(file){
      const reader = new FileReader();
      reader.onload = function(e){
        frames[i].src = e.target.result;
        frames[i].dataset.scale = 1;
        frames[i].style.transform = "scale(1)";
      }
      reader.readAsDataURL(file);
    }
  });
  photoInputsDiv.appendChild(input);

  // Zoom
  img.addEventListener("wheel", (e)=>{
    e.preventDefault();
    if(!img.src) return;
    let scale = parseFloat(img.dataset.scale) || 1;
    scale += e.deltaY < 0 ? 0.05 : -0.05;
    scale = Math.min(Math.max(scale,0.2),5);
    img.dataset.scale = scale;
    img.style.transform = `scale(${scale})`;
  });
});

// Emoji drag & drop
let selectedEmoji = null, offsetX=0, offsetY=0;
document.querySelectorAll(".emoji-option").forEach(emoji=>{
  emoji.addEventListener("click",()=>{
    const newEmoji = document.createElement("span");
    newEmoji.textContent = emoji.textContent;
    newEmoji.classList.add("emoji");
    newEmoji.style.top="50%";
    newEmoji.style.left="50%";
    frameContainer.appendChild(newEmoji);

    newEmoji.onmousedown = function(e){
      selectedEmoji=newEmoji;
      const rect = selectedEmoji.getBoundingClientRect();
      offsetX = e.clientX - rect.left;
      offsetY = e.clientY - rect.top;

      function moveAt(pageX,pageY){
        const containerRect = frameContainer.getBoundingClientRect();
        let x = pageX - containerRect.left - offsetX;
        let y = pageY - containerRect.top - offsetY;
        x=Math.max(0,Math.min(x, containerRect.width - selectedEmoji.offsetWidth));
        y=Math.max(0,Math.min(y, containerRect.height - selectedEmoji.offsetHeight));
        selectedEmoji.style.left = x + "px";
        selectedEmoji.style.top = y + "px";
      }

      function onMouseMove(event){ moveAt(event.pageX,event.pageY); }

      document.addEventListener("mousemove",onMouseMove);
      selectedEmoji.onmouseup = function(){
        document.removeEventListener("mousemove",onMouseMove);
        selectedEmoji.onmouseup=null;
        selectedEmoji=null;
      };
    };
    newEmoji.ondragstart = ()=>false;
  });
});

// Download
document.getElementById("downloadBtn").addEventListener("click",()=>{
  html2canvas(frameContainer,{scale:2}).then(canvas=>{
    const link=document.createElement("a");
    link.download=`Diwali_Collage_${name}.png`;
    link.href=canvas.toDataURL("image/png");
    link.click();
  });
});
</script>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</body>
</html>
